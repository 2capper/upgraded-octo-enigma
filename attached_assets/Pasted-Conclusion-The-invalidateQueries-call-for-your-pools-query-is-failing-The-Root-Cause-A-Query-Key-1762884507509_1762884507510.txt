Conclusion: The invalidateQueries call for your pools query is failing.

The Root Cause: A Query Key Mismatch
This is a classic, frustrating react-query bug. I know exactly why it's failing. The queryKey you are invalidating in PoolAssignment.tsx does not exactly match the queryKey you are fetching in DragScheduleBuilder.tsx.

Fetching Key (in DragScheduleBuilder.tsx line 472):

JavaScript

queryKey: ["/api/tournaments", tournamentId, "pools"]
(This is an array of three strings.)

Invalidating Key (My "Sledgehammer" fix in PoolAssignment.tsx):

JavaScript

queryKey: [`/api/tournaments/${tournamentId}/pools`]
(This is an array of one string.)

react-query sees these as two completely different queries. It invalidates the wrong key, so the scheduler's useQuery never refetches. It just keeps using its stale data (the "Unassigned" pool).

We are going to fix this, once and for all.

ðŸš€ Iteration 27: The "Exact Key Match" Fix
Goal: Fix the stale cache bug by making the invalidateQueries key in PoolAssignment.tsx an exact match for the useQuery key in DragScheduleBuilder.tsx.

Your Mandate: You are in src/components/PoolAssignment.tsx.

1. Step-by-Step: Fix the generateMutation.onSuccess Handler

Go to your generateMutation (line 304).

Replace the entire onSuccess handler with this final, correct version. The only change is the queryKey for pools, but we will use the full, correct block to be safe.

JavaScript

Â  Â  onSuccess: (data) => {
Â  Â  Â  // We invalidate all three keys the scheduler depends on.
Â  Â  Â Â 
Â  Â  Â  // 1. Invalidate Matchups
Â  Â  Â  queryClient.invalidateQueries({
Â  Â  Â  Â  queryKey: ['/api/tournaments', tournamentId, 'matchups'] 
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  // 2. Invalidate Games
Â  Â  Â  queryClient.invalidateQueries({ 
Â  Â  Â  Â  queryKey: ['/api/tournaments', tournamentId, 'games']
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  // 3. --- THIS IS THE FIX ---
Â  Â  Â  // This key now EXACTLY matches the key in DragScheduleBuilder.tsx
Â  Â  Â  queryClient.invalidateQueries({ 
Â  Â  Â  Â  queryKey: ['/api/tournaments', tournamentId, 'pools']
Â  Â  Â  });
Â  Â  Â  // --- END FIX ---

Â  Â  Â  // 4. We can also invalidate Age Divisions, just to be safe.
Â  Â  Â  queryClient.invalidateQueries({ 
Â  Â  Â  Â  queryKey: [`/api/tournaments/${tournamentId}/age-divisions`]
Â  Â  Â  });

Â  Â  Â  toast({
Â  Â  Â  Â  title: "Matchups Created!",
Â  Â  Â  Â  description: `Scroll down to see the schedule builder.`,
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  if (onMatchupsGenerated) {
Â  Â  Â  Â  onMatchupsGenerated();
Â  Â  Â  }
Â  Â  },